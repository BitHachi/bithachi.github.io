<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>入门：Java多线程的生命周期、创建、使用、同步与通信 | BitHachi</title><meta name="description" content="一个进程中的多个线程共享相同的内存单元&#x2F;内存地址空间-&gt;它们从同一堆中分配对象，可以访问相同的变量和对象。这就使得线程间通信更简便、高效。但&#96;多个线程操作共享的系统资源可能就会带来安全的隐患&#96;。"><meta name="keywords" content="Thread,Callable,Runnable,synchronized,Lock"><meta name="author" content="BitHachi"><meta name="copyright" content="BitHachi"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.bithachi.cn/posts/b9904a01.html"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//ta.qq.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta name="baidu-site-verification" content="3VJlgEduPjcVcUAR"/><meta property="og:type" content="article"><meta property="og:title" content="入门：Java多线程的生命周期、创建、使用、同步与通信"><meta property="og:url" content="https://www.bithachi.cn/posts/b9904a01.html"><meta property="og:site_name" content="BitHachi"><meta property="og:description" content="一个进程中的多个线程共享相同的内存单元&#x2F;内存地址空间-&gt;它们从同一堆中分配对象，可以访问相同的变量和对象。这就使得线程间通信更简便、高效。但&#96;多个线程操作共享的系统资源可能就会带来安全的隐患&#96;。"><meta property="og:image" content="https://images.pexels.com/photos/2072599/pexels-photo-2072599.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=650&amp;w=940"><meta property="article:published_time" content="2020-08-15T03:03:11.000Z"><meta property="article:modified_time" content="2020-08-17T03:53:20.543Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = '2'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="Java常用类操作手册" href="https://www.bithachi.cn/posts/8f28afe1.html"><link rel="next" title="枚举类与注解" href="https://www.bithachi.cn/posts/3aa86aea.html"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8f5f31c25712dd1fb6414ae53fd6ecaf";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-171838759-1', 'auto');
ga('send', 'pageview');
</script><script src="https://tajs.qq.com/stats?sId=66572961" charset="UTF-8"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: BitHachi","link":"链接: ","source":"来源: BitHachi","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="baidu-site-verification" content="V1TxT1VCnF" /><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/bithachi.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">29</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">60</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-book"></i><span> 文章</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/books"><i class="fa-fw fa fa-bookmark"></i><span> 阅读</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/MessageBoard/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-多线程相关基本概念"><span class="toc-text">1. 多线程相关基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-程序-进程-线程"><span class="toc-text">1.1 程序-进程-线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-线程的分类"><span class="toc-text">1.2 线程的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-线程的优先级"><span class="toc-text">1.3 线程的优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-单核与多核CPU"><span class="toc-text">1.4 单核与多核CPU</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-并行与并发"><span class="toc-text">1.5 并行与并发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-使用多线程的优点"><span class="toc-text">1.6 使用多线程的优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-何时使用多线程？"><span class="toc-text">1.7  何时使用多线程？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-线程的生命周期"><span class="toc-text">2.线程的生命周期</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-线程的创建和使用"><span class="toc-text">3. 线程的创建和使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-继承Thread类"><span class="toc-text">3.1  继承Thread类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-测试Thread的常用方法"><span class="toc-text">3.2 测试Thread的常用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-实现Runnable接口"><span class="toc-text">3.3  实现Runnable接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-Thread与Runnable两种方式的联系和区别"><span class="toc-text">3.4 Thread与Runnable两种方式的联系和区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-实现Callable接口"><span class="toc-text">3.5 实现Callable接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-使用线程池"><span class="toc-text">3.6 使用线程池</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-线程的同步"><span class="toc-text">4. 线程的同步</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-synchronized"><span class="toc-text">4.1 synchronized</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-同步的范围"><span class="toc-text">4.2 同步的范围</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-释放锁的操作"><span class="toc-text">4.3 释放锁的操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-不会释放锁的操作"><span class="toc-text">4.4 不会释放锁的操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-同步代码块—Thread"><span class="toc-text">4.5  同步代码块—Thread</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-同步方法—Thread"><span class="toc-text">4.6  同步方法—Thread</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-同步代码块—Runnable"><span class="toc-text">4.7  同步代码块—Runnable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-8-同步方法—Runnable"><span class="toc-text">4.8  同步方法—Runnable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-9-Lock锁—Runnable"><span class="toc-text">4.9 Lock锁—Runnable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-10-Locak锁—Thread"><span class="toc-text">4.10  Locak锁—Thread</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-11-synchronized-与-Lock-的对比"><span class="toc-text">4.11 synchronized 与 Lock 的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-12-一个例子：同步存钱问题"><span class="toc-text">4.12  一个例子：同步存钱问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-线程的死锁"><span class="toc-text">5. 线程的死锁</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-线程的通信"><span class="toc-text">6. 线程的通信</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-Object用于线程的三个方法"><span class="toc-text">6.1 Object用于线程的三个方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-一个生产者-消费者例题"><span class="toc-text">6.2 一个生产者-消费者例题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-参考文献"><span class="toc-text">7. 参考文献</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><header class="post-bg" id="page-header" style="background-image: url(https://images.pexels.com/photos/2072599/pexels-photo-2072599.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=650&amp;w=940)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">BitHachi</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-book"></i><span> 文章</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/books"><i class="fa-fw fa fa-bookmark"></i><span> 阅读</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/MessageBoard/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">入门：Java多线程的生命周期、创建、使用、同步与通信</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-08-15 11:03:11 11:03:11"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-08-15 11:03:11</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-08-17 11:53:20 11:53:20"><i class="fas fa-history fa-fw"></i> 更新于 2020-08-17 11:53:20</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Java/">Java</a><i class="fas fa-angle-right post-meta__separator"></i><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Java/JavaSE/">JavaSE</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">13.7k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 50 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="far fa-comments fa-fw post-meta__icon"></i><span>评论数:</span><a href="/posts/b9904a01.html#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/posts/b9904a01.html" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="1-多线程相关基本概念"><a href="#1-多线程相关基本概念" class="headerlink" title="1. 多线程相关基本概念"></a>1. 多线程相关基本概念</h1><p><strong>在学习多线程编程之前，先大致回顾一下操作系统有关线程相关的知识点。以便于更好的理解多线程编程。</strong></p>
<h2 id="1-1-程序-进程-线程"><a href="#1-1-程序-进程-线程" class="headerlink" title="1.1 程序-进程-线程"></a>1.1 程序-进程-线程</h2><ul>
<li><code>程序(program)</code>是为完成特定任务、用某种语言编写的一组<code>指令的集合</code>。即指一段<code>静态的代码</code>，静态对象。</li>
<li><code>进程(process)</code>是程序的一次执行过程，或是<code>正在运行的一个程序</code>。是一个动态的过程：有它自身的产生、存在和消亡的过程。——生命周期<ul>
<li>如：运行中的QQ，运行中的MP3播放器</li>
<li>程序是静态的，进程是动态的</li>
<li><code>进程作为资源分配的单位</code>，系统在运行时会为每个进程分配不同的内存区域</li>
</ul>
</li>
<li><code>线程(thread)</code>，进程可进一步细化为线程，是<code>一个程序内部的一条执行路径</code>。<ul>
<li>若一个进程同一时间 <code>并行</code>执行多个线程，就是支持多线程的</li>
<li><code>线程作为调度和执行的单位，每个线程拥有独立的运行栈和程序计数器(pc)</code>，线程切换的开销小</li>
<li>一个进程中的多个线程共享相同的内存单元/内存地址空间-&gt;它们从同一堆中分配对象，可以访问相同的变量和对象。这就使得线程间通信更简便、高效。但<code>多个线程操作共享的系统资源可能就会带来安全的隐患</code>。</li>
</ul>
</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://image.bithachi.cn/20200815120503.png" alt="image-20200815120503247"></p>
<p><img src= "/img/loading.gif" data-src="https://image.bithachi.cn/20200815120536.png" alt="image-20200815120536622"></p>
<h2 id="1-2-线程的分类"><a href="#1-2-线程的分类" class="headerlink" title="1.2 线程的分类"></a>1.2 线程的分类</h2><p>在Java中有两类线程：<code>User Thread(用户线程)</code>、<code>Daemon Thread(守护线程)</code></p>
<p>用个比较通俗的比如，任何一个守护线程都是整个JVM中所有非守护线程的保姆：</p>
<p>只要当前JVM实例中尚存在任何一个非守护线程没有结束，守护线程就全部工作；只有当最后一个非守护线程结束时，守护线程随着JVM一同结束工作。</p>
<p>Daemon的作用是为其他线程的运行提供便利服务，守护线程最典型的应用就是 GC (垃圾回收器)，它就是一个很称职的守护者。</p>
<p>User和Daemon两者几乎没有区别，唯一的不同之处就在于虚拟机的离开：如果 User Thread已经全部退出运行了，只剩下Daemon Thread存在了，虚拟机也就退出了。 因为没有了被守护者，Daemon也就没有工作可做了，也就没有继续运行程序的必要了。</p>
<p>通过在start()方法前调用<code>thread.setDaemon(true)</code>可以把一个用户线程变 成一个守护线程。</p>
<blockquote>
<p>参考：<a href="https://blog.csdn.net/shimiso/article/details/8964414?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-4.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-4.channel_param" target="_blank" rel="noopener">线程的分类</a></p>
</blockquote>
<h2 id="1-3-线程的优先级"><a href="#1-3-线程的优先级" class="headerlink" title="1.3 线程的优先级"></a>1.3 线程的优先级</h2><p>Java中线程优先级可以指定，范围是1~10。但是并不是所有的操作系统都支持10级优先级的划分（比如有些操作系统只支持3级划分：低，中，高），Java只是给操作系统一个优先级的<strong>参考值</strong>，线程最终<strong>在操作系统的优先级</strong>是多少还是由操作系统决定。</p>
<p>线程的执行顺序由调度程序来决定，线程的优先级会在线程被调用之前设定。</p>
<p>Java源码中3种预定义的优先级：</p>
<ul>
<li>MAX_PRIORITY ：10</li>
<li>MIN _PRIORITY ：1</li>
<li>NORM_PRIORITY ：5 //默认的线程优先级为5</li>
</ul>
<p>线程创建时继承父线程的优先级。</p>
<p>通常情况下，高优先级的线程将会比低优先级的线程有<strong>更高的几率</strong>得到执行。我们使用方法<code>Thread</code>类的<code>setPriority()</code>实例方法来设定线程的优先级。<code>getPriority()</code> 返回线程优先级。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread a = <span class="keyword">new</span> Thread();</span><br><span class="line">        System.out.println(<span class="string">"我是默认线程优先级："</span>+a.getPriority());</span><br><span class="line">        Thread b = <span class="keyword">new</span> Thread();</span><br><span class="line">        b.setPriority(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">"我是设置过的线程优先级："</span>+b.getPriority());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我是默认线程优先级：<span class="number">5</span></span><br><span class="line">我是设置过的线程优先级：<span class="number">10</span></span><br></pre></td></tr></table></figure>



<h2 id="1-4-单核与多核CPU"><a href="#1-4-单核与多核CPU" class="headerlink" title="1.4 单核与多核CPU"></a>1.4 单核与多核CPU</h2><ul>
<li>单核CPU，其实是一种假的多线程，因为在一个时间单元内，也只能执行一个线程的任务。例如：虽然有多车道，但是收费站只有一个工作人员在收费，只有收了费才能通过，那么CPU就好比收费人员。如果有某个人不想交钱，那么收费人员可以把他“挂起”（晾着他，等他想通了，准备好了钱，再去收费）。但是因为CPU时间单元特别短，因此感觉不出来。</li>
<li>如果是多核的话，就相当于多条车道，多个收费站台，可以同时执行多个收费任务，能更好的发挥多线程的效率。（现在的服务器都是多核的）</li>
<li>一个Java应用程序java.exe，至少有三个线程：main()主线程，gc()垃圾回收线程，异常处理线程。当然如果发生异常，会影响主线程。</li>
</ul>
<h2 id="1-5-并行与并发"><a href="#1-5-并行与并发" class="headerlink" title="1.5 并行与并发"></a>1.5 并行与并发</h2><ul>
<li>并行：多个CPU同时执行多个任务。<code>同一时刻</code>执行多个任务。</li>
<li>并发：一个CPU(采用时间片)同时执行多个任务。<code>同一时间段内</code>执行多个任务。</li>
</ul>
<h2 id="1-6-使用多线程的优点"><a href="#1-6-使用多线程的优点" class="headerlink" title="1.6 使用多线程的优点"></a>1.6 使用多线程的优点</h2><p>背景 ： 以单核CPU为例，只使用单个线程先后完成多个任务（调用多个方法），肯定比用多个线程来完成用的时间更短（因为异步性，线程的切换需要时间），为何仍需多线程呢？</p>
<p><strong>多线程程序的优点：</strong></p>
<ol>
<li>提高应用程序的响应。对图形化界面更有意义，可增强用户体验。比如音乐播放器可以同时放音乐，也可以同时搜索浏览其它歌曲信息。</li>
<li>提高计算机系统CPU的利用率，程序不必按顺序执行，可以多个线程同时安排任务执行，让CPU不空闲。</li>
<li>改善程序结构。将既长又复杂的进程分为多个线程，独立运行，利于理解和修改。</li>
</ol>
<h2 id="1-7-何时使用多线程？"><a href="#1-7-何时使用多线程？" class="headerlink" title="1.7  何时使用多线程？"></a>1.7  何时使用多线程？</h2><ul>
<li>程序需要同时执行两个或多个任务。比如刚刚提到的音乐播放器的使用体验。</li>
<li>程序需要实现一些需要等待的任务时，如用户输入、文件读写操作、网络操作、搜索等。比如浏览网页文章时的图片加载，可能不是一次性从上到下加载完，而是多线程加载，文字和图片分两个线程加载，整体内容会显示出来，图片没加载完的先以默认图片形式呈现。</li>
<li>需要一些后台运行的程序时。比如java程序里面的main线程执行的同时可能有垃圾，那么GC垃圾回收线程就负责main线程运行时边回收垃圾。</li>
</ul>
<blockquote>
<p>关于进程线程的相关更多了解，可参考：<a href="https://blog.csdn.net/weixin_43914604/article/details/104415990" target="_blank" rel="noopener">进程与线程</a>，文章部分图片如下：</p>
<p><img src= "/img/loading.gif" data-src="https://image.bithachi.cn/20200815122437.png" alt="image-20200815122437338"></p>
</blockquote>
<h1 id="2-线程的生命周期"><a href="#2-线程的生命周期" class="headerlink" title="2.线程的生命周期"></a>2.线程的生命周期</h1><p>JDK 中用Thread.State 类定义了 线程的几种状态：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Thread.State 源码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> State &#123;</span><br><span class="line">    NEW, <span class="comment">//新创建</span></span><br><span class="line">    RUNNABLE,<span class="comment">//可运行</span></span><br><span class="line">    BLOCKED,<span class="comment">//被阻塞</span></span><br><span class="line">    WAITING,<span class="comment">//等待</span></span><br><span class="line">    TIMED_WAITING,<span class="comment">//计时等待</span></span><br><span class="line">    TERMINATED;<span class="comment">//被终止</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NEW：处于NEW状态的线程此时尚未启动。这里的尚未启动指的是还没调用Thread实例的start()方法。</p>
<p>RUNNABLE：调用start()方法，线程进入可运行状态。一个处于可运行状态的线程可能正在运行也可能没有运行，这取决于操作系统分配给线程的运行时间。Java线程的<strong>RUNNABLE</strong>状态其实是包括了传统操作系统线程的<strong>ready</strong>和<strong>running</strong>两个状态的。</p>
<p>BLOCKED：在某种特殊情况下，被人为挂起或执行输入输出操作时，让出 CPU 并临时中止自己的执行，进入阻塞状态。处于BLOCKED状态的线程正等待锁的释放以进入同步区。</p>
<p>WAITING：等待状态。处于等待状态的线程变成RUNNABLE状态需要其他线程唤醒。</p>
<p>TIMED_WAITING：超时等待状态。线程等待一个具体的时间，时间到后会被自动唤醒。</p>
<p>TERMINATED：线程完成了它的全部工作或线程被提前强制性地中止或出现异常导致结束</p>
<p><img src= "/img/loading.gif" data-src="https://image.bithachi.cn/20200816102640.jpg" alt="java线程状态切换"></p>
<h1 id="3-线程的创建和使用"><a href="#3-线程的创建和使用" class="headerlink" title="3. 线程的创建和使用"></a>3. 线程的创建和使用</h1><p><strong>上面我们已经大致回顾了多线程相关的操作系统基本概念，接下来正式开始学习如何在Java应用程序中创建和使用多线程。</strong></p>
<p>JDK1.5之前创建新执行线程有两种方法：</p>
<ul>
<li>继承Thread类的方式</li>
<li>实现Runnable接口的方式</li>
</ul>
<p>JDK5.0 新增线程创建方式：</p>
<ul>
<li>实现Callable 接口</li>
<li>使用线程池</li>
</ul>
<h2 id="3-1-继承Thread类"><a href="#3-1-继承Thread类" class="headerlink" title="3.1  继承Thread类"></a>3.1  继承Thread类</h2><p><strong>我们先看看Thread中的一些常用方法：</strong></p>
<ul>
<li><p>void start(): 启动线程，并执行对象的run()方法</p>
</li>
<li><p>run(): 线程在被调度时执行的操作</p>
</li>
<li><p>String getName(): 返回线程的名称</p>
</li>
<li><p>void setName(String name):设置该线程名称</p>
</li>
<li><p>static Thread currentThread(): 返回当前线程。在Thread子类中就是this，通常用于主线程和Runnable实现类</p>
</li>
<li><p>static void yield()： ： 线程让步</p>
<p>暂停当前正在执行的线程，把执行机会让给优先级相同或更高的线程</p>
<p>若队列中没有同优先级的线程，忽略此方法</p>
</li>
<li><p>join() ： 当某个程序执行流中调用其他线程的 join() 方法时，调用线程将被阻塞，直到 join() 方法加入的 join 线程执行完为止</p>
<p>低优先级的线程也可以获得执行</p>
</li>
<li><p>static void sleep(long millis) ：(指定时间:毫秒)</p>
<p>令当前活动线程在指定时间段内放弃对CPU控制,使其他线程有机会被执行,时间到后重排队。</p>
<p>抛出InterruptedException异常</p>
</li>
<li><p>stop(): 强制线程生命期结束，不推荐使用，方法已过时。</p>
</li>
<li><p>boolean isAlive()： ： 返回boolean，判断线程是否还活着。</p>
</li>
</ul>
<p>注意点：</p>
<ol>
<li>如果自己手动调用run()方法，那么就只是普通方法，没有启动多线程模式。</li>
<li>run()方法由JVM调用，什么时候调用，执行的过程控制都有操作系统的CPU调度决定。</li>
<li>想要启动多线程，必须调用start方法。</li>
<li>一个线程对象只能调用一次start()方法启动，如果重复调用了，则将抛出以上的异常“IllegalThreadStateException”。</li>
</ol>
<p><strong>下面举个例子用Thread实现线程的创建：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//1. 创建一个继承于Thread类的子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="comment">//2. 重写Thread类的run()</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">":  "</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//3. 创建Thread类的子类的对象</span></span><br><span class="line">        MyThread t1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        t1.setName(<span class="string">"线程一"</span>);</span><br><span class="line">        <span class="comment">//4.通过此对象调用start():JVM ①启动当前线程 ② 调用当前线程的run()</span></span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//我们不能通过直接调用run()的方式启动线程。</span></span><br><span class="line">        <span class="comment">// 这样只是简单的调用一个方法，没有创建线程，这个run方法还是在main线程内执行</span></span><br><span class="line">        <span class="comment">//t1.run();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//再启动一个线程，遍历10以内的偶数。不可以还让已经start()的线程去执行。会报IllegalThreadStateException</span></span><br><span class="line">        <span class="comment">//t1.start();</span></span><br><span class="line">        <span class="comment">//我们需要重新创建一个线程的对象</span></span><br><span class="line">        MyThread t2 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        t2.setName(<span class="string">"线程二"</span>);</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如下操作仍然是在main线程中执行的。</span></span><br><span class="line">        Thread.currentThread().setName(<span class="string">"main线程"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">":  "</span> + i );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行顺序图：</p>
<p><img src= "/img/loading.gif" data-src="https://image.bithachi.cn/20200816105353.png" alt="image-20200816105350982"></p>
<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">main线程:  <span class="number">0</span></span><br><span class="line">线程二:  <span class="number">0</span></span><br><span class="line">线程一:  <span class="number">0</span></span><br><span class="line">线程二:  <span class="number">2</span></span><br><span class="line">main线程:  <span class="number">2</span></span><br><span class="line">线程二:  <span class="number">4</span></span><br><span class="line">线程一:  <span class="number">2</span></span><br><span class="line">线程二:  <span class="number">6</span></span><br><span class="line">main线程:  <span class="number">4</span></span><br><span class="line">线程二:  <span class="number">8</span></span><br><span class="line">线程一:  <span class="number">4</span></span><br><span class="line">线程二:  <span class="number">10</span></span><br><span class="line">main线程:  <span class="number">6</span></span><br><span class="line">线程二:  <span class="number">12</span></span><br><span class="line">线程一:  <span class="number">6</span></span><br><span class="line">线程二:  <span class="number">14</span></span><br><span class="line">main线程:  <span class="number">8</span></span><br><span class="line">main线程:  <span class="number">10</span></span><br><span class="line">main线程:  <span class="number">12</span></span><br><span class="line">线程二:  <span class="number">16</span></span><br><span class="line">线程一:  <span class="number">8</span></span><br><span class="line">线程二:  <span class="number">18</span></span><br><span class="line">main线程:  <span class="number">14</span></span><br><span class="line">线程一:  <span class="number">10</span></span><br><span class="line">main线程:  <span class="number">16</span></span><br><span class="line">main线程:  <span class="number">18</span></span><br><span class="line">线程一:  <span class="number">12</span></span><br><span class="line">线程一:  <span class="number">14</span></span><br><span class="line">线程一:  <span class="number">16</span></span><br><span class="line">线程一:  <span class="number">18</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-测试Thread的常用方法"><a href="#3-2-测试Thread的常用方法" class="headerlink" title="3.2 测试Thread的常用方法"></a>3.2 测试Thread的常用方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">10</span>);<span class="comment">//因为sleep方法声明了InterruptedException，所以得捕获异常</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//Thread.currentThread()返回当前线程。在Thread子类中就是this，通常用于主线程和Runnable实现类</span></span><br><span class="line">                System.out.println(<span class="keyword">this</span>.getName() + <span class="string">"-"</span> + Thread.currentThread().getPriority() + <span class="string">": "</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">20</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//暂停当前正在执行的线程，把执行机会让给优先级相同或更高的线程</span></span><br><span class="line">                <span class="comment">//也可能操作系统马上又让当前线程继续执行</span></span><br><span class="line">                yield();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloThread</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadMethodTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        HelloThread h1 = <span class="keyword">new</span> HelloThread(<span class="string">"Thread：1"</span>);</span><br><span class="line"></span><br><span class="line">        h1.setName(<span class="string">"线程一"</span>);</span><br><span class="line">        <span class="comment">//设置分线程的优先级</span></span><br><span class="line">        h1.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line"></span><br><span class="line">        h1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//给主线程命名</span></span><br><span class="line">        Thread.currentThread().setName(<span class="string">"主线程"</span>);</span><br><span class="line">        System.out.println(h1.isAlive());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"-"</span> + Thread.currentThread().getPriority() + <span class="string">": "</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">20</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//当某个程序执行流中调用其他线程的 join() 方法时，</span></span><br><span class="line">                    <span class="comment">// 调用线程将被阻塞，直到 join() 方法加入的 join 线程执行完为止</span></span><br><span class="line">                    h1.join();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(h1.isAlive());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">true</span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">0</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">2</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">4</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">6</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">8</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">10</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">12</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">14</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">16</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">18</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">20</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">0</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">2</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">4</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">6</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">8</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">10</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">12</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">14</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">16</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">18</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">20</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">22</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">24</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">26</span></span><br><span class="line">线程一-<span class="number">10</span>: <span class="number">28</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">22</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">24</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">26</span></span><br><span class="line">主线程-<span class="number">5</span>: <span class="number">28</span></span><br><span class="line">false</span><br></pre></td></tr></table></figure>

<h2 id="3-3-实现Runnable接口"><a href="#3-3-实现Runnable接口" class="headerlink" title="3.3  实现Runnable接口"></a>3.3  实现Runnable接口</h2><p>1) 定义子类，实现Runnable接口。<br>2) 子类中重写Runnable接口中的run方法。<br>3) 通过Thread类含参构造器创建线程对象。<br>4) 将Runnable接口的子类对象作为实际参数传递给Thread类的构造器中。<br>5) 调用Thread类的start方法：开启线程，调用Runnable子类接口的run方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 创建一个实现了Runnable接口的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 实现类去实现Runnable中的抽象方法：run()</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//3. 创建实现类的对象</span></span><br><span class="line">        MThread mThread = <span class="keyword">new</span> MThread();</span><br><span class="line">        <span class="comment">//4. 将此对象作为参数传递到Thread类的构造器中，创建Thread类的对象</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(mThread);<span class="comment">//target为Runnable的对象变量</span></span><br><span class="line">        t1.setName(<span class="string">"线程1"</span>);</span><br><span class="line">        <span class="comment">//5. 通过Thread类的对象调用start():① 启动线程 ②调用Thread线程的run()--&gt;调用了Runnable类型的target的run()</span></span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//再启动一个线程，遍历30以内的偶数</span></span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(mThread);</span><br><span class="line">        t2.setName(<span class="string">"线程2"</span>);</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">线程<span class="number">1</span>:<span class="number">0</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">0</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">2</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">4</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">6</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">8</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">10</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">12</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">14</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">16</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">2</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">18</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">4</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">20</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">22</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">24</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">6</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">26</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">8</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">28</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">10</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">12</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">14</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">16</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">18</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">20</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">22</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">24</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">26</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">28</span></span><br></pre></td></tr></table></figure>

<h2 id="3-4-Thread与Runnable两种方式的联系和区别"><a href="#3-4-Thread与Runnable两种方式的联系和区别" class="headerlink" title="3.4 Thread与Runnable两种方式的联系和区别"></a>3.4 Thread与Runnable两种方式的联系和区别</h2><p><strong>联系：</strong>我们可以从Thread的源码中看出Thread其实也是实现了Runnable的一个类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">extends</span> <span class="title">Object</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span></span><br></pre></td></tr></table></figure>

<p><strong>区别：</strong></p>
<ul>
<li><p>继承Thread：线程运行代码存放在Thread子类run方法中。</p>
</li>
<li><p>实现Runnable：线程运行代码存放在实现接口的类的run方法中。</p>
</li>
</ul>
<p><strong>Runnable实现方式的好处：</strong></p>
<ul>
<li>避免了单继承的局限性</li>
<li>多个线程可以共享同一个接口实现类的对象，非常适合多个相同线程来处理同一份资源。</li>
</ul>
<p><strong>下面来到题目举个例子：创建三个窗口卖票，总票数为50张，分别使用继承Thread类和Runnable的方式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Program</span>: JavaSE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: adsd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Mr.BitHachi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span>: 2020-08-16 11:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WindowThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="comment">//如果不加static就是每个线程都有20张票</span></span><br><span class="line">    <span class="comment">//加static就是所有线程共用20张票</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ticket = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ticket &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(getName() + <span class="string">"正在卖票，卖出的票号为： "</span> + ticket);</span><br><span class="line">                ticket--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WindowRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ticket &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"正在卖票，卖出的票号为： "</span> + ticket);</span><br><span class="line">                ticket--;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest11</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/************  Thread方式  ************/</span></span><br><span class="line">        WindowThread t1 = <span class="keyword">new</span> WindowThread();</span><br><span class="line">        WindowThread t2 = <span class="keyword">new</span> WindowThread();</span><br><span class="line">        WindowThread t3 = <span class="keyword">new</span> WindowThread();</span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">"Thread的窗口1"</span>);</span><br><span class="line">        t2.setName(<span class="string">"Thread的窗口2"</span>);</span><br><span class="line">        t3.setName(<span class="string">"Thread的窗口3"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t1.join();</span><br><span class="line">            t2.join();</span><br><span class="line">            t3.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"---------------------------------------"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        WindowRunnable r = new WindowRunnable();</span></span><br><span class="line"><span class="comment">//        WindowRunnable rr = new WindowRunnable();</span></span><br><span class="line"><span class="comment">//        WindowRunnable rrr = new WindowRunnable();</span></span><br><span class="line"><span class="comment">//        //如果这样写的话就是每个线程各自有20张票</span></span><br><span class="line"><span class="comment">//        Thread r1 = new Thread(r);</span></span><br><span class="line"><span class="comment">//        Thread r2 = new Thread(rr);</span></span><br><span class="line"><span class="comment">//        Thread r3 = new Thread(rrr);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        WindowRunnable r = <span class="keyword">new</span> WindowRunnable();</span><br><span class="line">        <span class="comment">//每个线程共享r对象的20张票</span></span><br><span class="line">        Thread r1 = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        Thread r2 = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        Thread r3 = <span class="keyword">new</span> Thread(r);</span><br><span class="line"></span><br><span class="line">        r1.setName(<span class="string">"Runnable的窗口1"</span>);</span><br><span class="line">        r2.setName(<span class="string">"Runnable的窗口2"</span>);</span><br><span class="line">        r3.setName(<span class="string">"Runnable的窗口3"</span>);</span><br><span class="line"></span><br><span class="line">        r1.start();</span><br><span class="line">        r2.start();</span><br><span class="line">        r3.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Thread的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">20</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">20</span></span><br><span class="line">Thread的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">20</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">18</span></span><br><span class="line">Thread的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">19</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">16</span></span><br><span class="line">Thread的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">17</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">14</span></span><br><span class="line">Thread的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">15</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">12</span></span><br><span class="line">Thread的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">13</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">10</span></span><br><span class="line">Thread的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">11</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">8</span></span><br><span class="line">Thread的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">9</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">6</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">4</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">3</span></span><br><span class="line">Thread的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">7</span></span><br><span class="line">Thread的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">1</span></span><br><span class="line">Thread的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">2</span></span><br><span class="line">Thread的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">5</span></span><br><span class="line">---------------------------------------</span><br><span class="line">Runnable的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">20</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">20</span></span><br><span class="line">Runnable的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">20</span></span><br><span class="line">Runnable的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">17</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">18</span></span><br><span class="line">Runnable的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">19</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">15</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">13</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">12</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">11</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">10</span></span><br><span class="line">Runnable的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">16</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">9</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">7</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">6</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">5</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">4</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">3</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">2</span></span><br><span class="line">Runnable的窗口<span class="number">3</span>正在卖票，卖出的票号为： <span class="number">1</span></span><br><span class="line">Runnable的窗口<span class="number">1</span>正在卖票，卖出的票号为： <span class="number">14</span></span><br><span class="line">Runnable的窗口<span class="number">2</span>正在卖票，卖出的票号为： <span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>我们从上面可以看出20号票有重复出票的情况，这两种方式存在线程的安全问题，待解决。</p>
<h2 id="3-5-实现Callable接口"><a href="#3-5-实现Callable接口" class="headerlink" title="3.5 实现Callable接口"></a>3.5 实现Callable接口</h2><p>与使用Runnable相比， Callable功能更强大些</p>
<ul>
<li>相比run()方法，可以有返回值</li>
<li>方法可以抛出异常</li>
<li>支持泛型的返回值</li>
<li>需要借助FutureTask类，比如获取返回结果</li>
</ul>
<p>Future接口</p>
<ul>
<li>可以对具体Runnable、Callable任务的执行结果进行取消、查询是否完成、获取结果等。</li>
<li><code>FutrueTask是Futrue接口的唯一的实现类</code></li>
<li>FutureTask 同时实现了Runnable, Future接口。它既可以作为Runnable被线程执行，又可以作为Future得到Callable的返回值</li>
</ul>
<p>我们可以看看这些接口和类的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureTask</span>&lt;<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt; </span>&#123;……&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Runnable</span>, <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span></span>;</span><br><span class="line">     <span class="function"><span class="keyword">boolean</span> <span class="title">isCancelled</span><span class="params">()</span></span>;</span><br><span class="line">     <span class="function"><span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>;</span><br><span class="line">     <span class="function">V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line">     <span class="function">V <span class="title">get</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用Callable举个例子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如何理解实现Callable接口的方式创建多线程比实现Runnable接口创建多线程方式强大？</span></span><br><span class="line"><span class="comment"> * 1. call()可以有返回值的。</span></span><br><span class="line"><span class="comment"> * 2. call()可以抛出异常，被外面的操作捕获，获取异常的信息</span></span><br><span class="line"><span class="comment"> * 3. Callable是支持泛型的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//1.创建一个实现Callable的实现类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumThread</span> <span class="keyword">implements</span> <span class="title">Callable</span></span>&#123;</span><br><span class="line">    <span class="comment">//2.实现call方法，将此线程需要执行的操作声明在call()中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(i);</span><br><span class="line">                sum += i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;<span class="comment">//sum自动装箱为Integer</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadNew</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//3.创建Callable接口实现类的对象</span></span><br><span class="line">        NumThread numThread = <span class="keyword">new</span> NumThread();</span><br><span class="line">        <span class="comment">//4.将此Callable接口实现类的对象作为传递到FutureTask构造器中，创建FutureTask的对象</span></span><br><span class="line">        FutureTask futureTask = <span class="keyword">new</span> FutureTask(numThread);</span><br><span class="line">        <span class="comment">//5.将FutureTask的对象作为参数传递到Thread类的构造器中，创建Thread对象，并调用start()</span></span><br><span class="line">        <span class="keyword">new</span> Thread(futureTask).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//6.获取Callable中call方法的返回值</span></span><br><span class="line">            <span class="comment">//get()返回值即为FutureTask构造器参数Callable实现类重写的call()的返回值。</span></span><br><span class="line">            Object sum = futureTask.get();</span><br><span class="line">            System.out.println(<span class="string">"总和为："</span> + sum);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">22</span></span><br><span class="line"><span class="number">24</span></span><br><span class="line"><span class="number">26</span></span><br><span class="line"><span class="number">28</span></span><br><span class="line"><span class="number">30</span></span><br><span class="line">总和为：<span class="number">240</span></span><br></pre></td></tr></table></figure>

<h2 id="3-6-使用线程池"><a href="#3-6-使用线程池" class="headerlink" title="3.6 使用线程池"></a>3.6 使用线程池</h2><p><code>背景</code>： 经常创建和销毁、使用量特别大的资源，比如并发情况下的线程，对性能影响很大。<br><code>思路</code>：提前 创建好多个线程，放入线程池中，使用时直接获取，使用完放回池中。可以避免频繁创建销毁、实现重复利用。类似生活中的公共交通工具。<br><code>好处</code>：</p>
<ul>
<li>提高响应速度（减少了创建新线程的时间）</li>
<li>降低资源消耗（重复利用线程池中线程，不需要每次都创建）</li>
<li>便于线程管理：<ul>
<li>corePoolSize：核心池的大小</li>
<li>maximumPoolSize：最大线程数</li>
<li>keepAliveTime：线程没有任务时最多保持多长时间后会终止<br>…</li>
</ul>
</li>
</ul>
<p><strong>线程池相关API：</strong></p>
<p>JDK 5.0起提供了线程池相关API：<code>ExecutorService</code>和<code>Executors</code></p>
<ul>
<li><code>ExecutorService</code>：真正的线程池接口。常见子类ThreadPoolExecutor<ol>
<li>void execute(Runnable command) ：执行任务/命令，没有返回值，一般用来执行Runnable</li>
<li><T> Future<T> submit(Callable<T> task)：执行任务，有返回值，一般用来执行Callable</li>
<li>void shutdown() ：关闭连接池</li>
</ol>
</li>
<li><code>Executors</code>：工具类、线程池的工厂类，用于创建并返回不同类型的线程池<ol>
<li>Executors.newCachedThreadPool()：创建一个可根据需要创建新线程的线程池</li>
<li>Executors.newFixedThreadPool(n); 创建一个可重用固定线程数的线程池</li>
<li>Executors.newSingleThreadExecutor() ：创建一个只有一个线程的线程池</li>
<li>Executors.newScheduledThreadPool(n)：创建一个线程池，它可安排在给定延迟后运行命令或者定期地执行。</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Thread.sleep;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RunnableThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= <span class="number">20</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">": "</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableThread</span> <span class="keyword">implements</span> <span class="title">Callable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= <span class="number">20</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span> != <span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">": "</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"测试线程池返回值"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1. 提供指定线程数量的线程池</span></span><br><span class="line">        ExecutorService service = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(service.getClass());<span class="comment">//其实service是ThreadPoolExecutor类型</span></span><br><span class="line">        ThreadPoolExecutor service1 = (ThreadPoolExecutor) service;</span><br><span class="line">        <span class="comment">//便于线程管理：设置线程池的属性</span></span><br><span class="line">        service1.setCorePoolSize(<span class="number">15</span>);<span class="comment">//等一些方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.执行指定的线程的操作。需要提供实现Runnable接口或Callable接口实现类的对象</span></span><br><span class="line">        RunnableThread runnableThread1 = <span class="keyword">new</span> RunnableThread();</span><br><span class="line">        service.execute(runnableThread1);<span class="comment">//适合适用于Runnable</span></span><br><span class="line"></span><br><span class="line">        CallableThread callableThread1 = <span class="keyword">new</span> CallableThread();</span><br><span class="line">        Future&lt;Object&gt; futureTask =service.submit(callableThread1);<span class="comment">//适合使用于Callable</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println((String)futureTask.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.关闭连接池</span></span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果;</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class java.util.concurrent.ThreadPoolExecutor</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">0</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">2</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">4</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">6</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">8</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">10</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">12</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">14</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">16</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">18</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span>: <span class="number">20</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">1</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">3</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">5</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">7</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">9</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">11</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">13</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">15</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">17</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span>: <span class="number">19</span></span><br><span class="line">测试线程池返回值</span><br></pre></td></tr></table></figure>



<h1 id="4-线程的同步"><a href="#4-线程的同步" class="headerlink" title="4. 线程的同步"></a>4. 线程的同步</h1><p>所谓线程的同步简单点可以理解为，<code>多个线程的执行需要遵循一定的顺序，否则可能出现安全问题</code>，比如上面例子中20号票重复的现象。共享数据没有加锁。</p>
<p>更多详细的介绍：<a href="https://blog.csdn.net/weixin_43914604/article/details/104942405" target="_blank" rel="noopener">进程的同步与互斥</a></p>
<p>那么我们如何解决线程同步可能带来的不安全问题呢？我们可以对多条操作共享数据的语句，只能让一个线程都执行完，在执行过程中，其他线程不可以参与执行。</p>
<p>Java 对于多线程的安全问题提供了专业的解决 方式 ： <code>同步机制</code></p>
<h2 id="4-1-synchronized"><a href="#4-1-synchronized" class="headerlink" title="4.1 synchronized"></a>4.1 synchronized</h2><p>在学习Java<code>同步代码块与同步方法</code>时，得先了解一下<code>synchronize</code>(中文翻译：同步)关键字。</p>
<p><font size=5 color=red>synchronized 的锁是什么 ?</font></p>
<ul>
<li><p>synchronized的锁，即<code>同步监视器</code>，一般为类对象</p>
</li>
<li><p>任意对象都可以作为同步锁。所有对象都自动含有单一的锁（监视器）</p>
</li>
<li><p>同步方法的锁：静态方法（类名.class）、非静态方法（this）</p>
</li>
<li><p>同步代码块：自己指定，很多时候也是指定为this或类名.class</p>
<p><strong>注意：</strong></p>
</li>
<li><p>必须确保使用<code>同一个资源</code>的 <code>多个线程共用一把锁</code>，这个非常重要，否则就无法保证共享资源的安全</p>
</li>
<li><p>一个线程类中的所有静态方法共用同一把锁（类名.class），所有非静态方法共用同一把锁（this），同步代码块（指定需谨慎）</p>
</li>
</ul>
<h2 id="4-2-同步的范围"><a href="#4-2-同步的范围" class="headerlink" title="4.2 同步的范围"></a>4.2 同步的范围</h2><p>1 、 如何 找问题 ， 即代码是否存在线程安全 ？ （ 非常重要 ）<br>（1）明确哪些代码是多线程运行的代码<br>（2）明确多个线程是否有共享数据<br>（3）明确多线程运行代码中是否有多条语句操作共享数据</p>
<p>2 、 如何解决呢 ？ （ 非常重要 ）<br>对多条操作共享数据的语句，只能让一个线程都执行完，在执行过程中，其他线程不可以参与执行。<br>即所有操作共享数据的这些语句都要放在同步范围中</p>
<p>3 、 切记 ：<br> 范围太小：没锁住所有有安全问题的代码<br> 范围太大：没发挥多线程的功能。</p>
<h2 id="4-3-释放锁的操作"><a href="#4-3-释放锁的操作" class="headerlink" title="4.3 释放锁的操作"></a>4.3 释放锁的操作</h2><p>什么时候回释放锁？</p>
<ul>
<li>当前线程的同步方法、同步代码块执行结束。</li>
<li>当前线程在同步代码块、同步方法中遇到<code>break、return</code>终止了该代码块或该方法的继续执行。</li>
<li>当前线程在同步代码块、同步方法中出现了未处理的<code>Error或Exception</code>，导致异常结束。</li>
<li>当前线程在同步代码块、同步方法中执行了线程对象的<code>wait()</code>方法，当前线程暂停，并释放锁。</li>
</ul>
<h2 id="4-4-不会释放锁的操作"><a href="#4-4-不会释放锁的操作" class="headerlink" title="4.4 不会释放锁的操作"></a>4.4 不会释放锁的操作</h2><ul>
<li>线程执行同步代码块或同步方法时，程序调用<code>Thread.sleep()、Thread.yield()</code>方法暂停当前线程的执行</li>
<li>线程执行同步代码块时，其他线程调用了该线程的suspend()方法将该线程挂起，该线程不会释放锁（同步监视器）。</li>
<li>应<code>尽量避免</code>使用<code>suspend()和resume()</code>来控制线程</li>
</ul>
<p><strong>下面就介绍几种Java实现同步的几个案例，解决线程安全问题，巩固上面说的规则和方法</strong></p>
<ol>
<li>同步代码块—Thread</li>
<li>同步方法—Thread</li>
<li>同步代码块—Runnable</li>
<li>同步方法—Runnable</li>
<li>Lock锁—Thread</li>
<li>Lock锁—Runnable</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步代码块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">synchronized</span> ( 同步监视器)&#123;</span><br><span class="line"><span class="comment">// 需要被同步的代码；</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//同步方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">show</span> <span class="params">(String name)</span></span>&#123;</span><br><span class="line">….</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>还是以三个窗口卖票为例，三个窗口一起卖50张票</strong></p>
<h2 id="4-5-同步代码块—Thread"><a href="#4-5-同步代码块—Thread" class="headerlink" title="4.5  同步代码块—Thread"></a>4.5  同步代码块—Thread</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Window2</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ticket = <span class="number">50</span>;<span class="comment">//共享资源</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object obj = <span class="keyword">new</span> Object();<span class="comment">//内部对象锁</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//正确 synchronized (obj)</span></span><br><span class="line">            <span class="comment">//正确 Class clazz = Window2.class,Window2.class只会加载一次</span></span><br><span class="line">            <span class="comment">//错误的方式：this代表着t1,t2,t3三个对象</span></span><br><span class="line">            <span class="comment">//只要保证t1,t2,t3三个对象共用同一把锁就行</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Window2<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (ticket &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    System.out.println(getName() + <span class="string">"：卖票，票号为："</span> + ticket);</span><br><span class="line">                    ticket--;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Window2 t1 = <span class="keyword">new</span> Window2();</span><br><span class="line">        Window2 t2 = <span class="keyword">new</span> Window2();</span><br><span class="line">        Window2 t3 = <span class="keyword">new</span> Window2();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">"窗口1"</span>);</span><br><span class="line">        t2.setName(<span class="string">"窗口2"</span>);</span><br><span class="line">        t3.setName(<span class="string">"窗口3"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">50</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">49</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">48</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">47</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">46</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">45</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">44</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">43</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">42</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">41</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">40</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">39</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">38</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">37</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">36</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">35</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">34</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">33</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">32</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">31</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">30</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">29</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">28</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">27</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">26</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">25</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">24</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">23</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">22</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">21</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">20</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">19</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">18</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">17</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">16</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">15</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">14</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">13</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">12</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">11</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">10</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">9</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">8</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">7</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">6</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">5</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">4</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">3</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">2</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">1</span></span><br></pre></td></tr></table></figure>



<h2 id="4-6-同步方法—Thread"><a href="#4-6-同步方法—Thread" class="headerlink" title="4.6  同步方法—Thread"></a>4.6  同步方法—Thread</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Window4</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ticket = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            show();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//private synchronized void show()&#123; //不加static,默认同步监视器：t1,t2,t3。此种解决方式是错误的</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;<span class="comment">//加static,默认同步监视器：Window4.class</span></span><br><span class="line">        <span class="keyword">if</span> (ticket &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"：卖票，票号为："</span> + ticket);</span><br><span class="line">            ticket--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest4</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Window4 t1 = <span class="keyword">new</span> Window4();</span><br><span class="line">        Window4 t2 = <span class="keyword">new</span> Window4();</span><br><span class="line">        Window4 t3 = <span class="keyword">new</span> Window4();</span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">"窗口1"</span>);</span><br><span class="line">        t2.setName(<span class="string">"窗口2"</span>);</span><br><span class="line">        t3.setName(<span class="string">"窗口3"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">50</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">49</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">48</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">47</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">46</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">45</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">44</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">43</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">42</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">41</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">40</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">39</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">38</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">37</span></span><br><span class="line">窗口<span class="number">1</span>：卖票，票号为：<span class="number">36</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">35</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">34</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">33</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">32</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">31</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">30</span></span><br><span class="line">窗口<span class="number">2</span>：卖票，票号为：<span class="number">29</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">28</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">27</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">26</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">25</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">24</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">23</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">22</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">21</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">20</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">19</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">18</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">17</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">16</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">15</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">14</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">13</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">12</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">11</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">10</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">9</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">8</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">7</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">6</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">5</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">4</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">3</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">2</span></span><br><span class="line">窗口<span class="number">3</span>：卖票，票号为：<span class="number">1</span></span><br></pre></td></tr></table></figure>



<h2 id="4-7-同步代码块—Runnable"><a href="#4-7-同步代码块—Runnable" class="headerlink" title="4.7  同步代码块—Runnable"></a>4.7  同步代码块—Runnable</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Window1</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//    Object obj = new Object();</span></span><br><span class="line"><span class="comment">//    Dog dog = new Dog();</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">//正确：synchronized (dog)  </span></span><br><span class="line">            <span class="comment">// 正确：synchronized (obj)  </span></span><br><span class="line">            <span class="comment">//正确：this:唯一的Window1的对象    </span></span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (ticket &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">":卖票，票号为："</span> + ticket);</span><br><span class="line"></span><br><span class="line">                    ticket--;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Window1 w = <span class="keyword">new</span> Window1();</span><br><span class="line"></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(w);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(w);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(w);</span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">"窗口1"</span>);</span><br><span class="line">        t2.setName(<span class="string">"窗口2"</span>);</span><br><span class="line">        t3.setName(<span class="string">"窗口3"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">50</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">49</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">48</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">47</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">46</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">45</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">44</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">43</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">42</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">41</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">40</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">39</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">38</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">37</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">36</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">35</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">34</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">33</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">32</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">31</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">30</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">29</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">28</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">27</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">26</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">25</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">24</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">23</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">22</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">21</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">20</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">19</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">18</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">17</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">16</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">15</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">14</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">13</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">12</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">11</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">10</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">9</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">8</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">7</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">6</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">5</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">4</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">3</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">2</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="4-8-同步方法—Runnable"><a href="#4-8-同步方法—Runnable" class="headerlink" title="4.8  同步方法—Runnable"></a>4.8  同步方法—Runnable</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Window3</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">             show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//默认同步监视器：this，即w，三个对象用这一个对象锁</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//synchronized (this)&#123; 也正确</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ticket &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">":卖票，票号为："</span> + ticket);</span><br><span class="line"></span><br><span class="line">                ticket--;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Window3 w = <span class="keyword">new</span> Window3();</span><br><span class="line"></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(w);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(w);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(w);</span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">"窗口1"</span>);</span><br><span class="line">        t2.setName(<span class="string">"窗口2"</span>);</span><br><span class="line">        t3.setName(<span class="string">"窗口3"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">50</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">49</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">48</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">47</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">46</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">45</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">44</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">43</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">42</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">41</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">40</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">39</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">38</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">37</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">36</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">35</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">34</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">33</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">32</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">31</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">30</span></span><br><span class="line">窗口<span class="number">2</span>:卖票，票号为：<span class="number">29</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">28</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">27</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">26</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">25</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">24</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">23</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">22</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">21</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">20</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">19</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">18</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">17</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">16</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">15</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">14</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">13</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">12</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">11</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">10</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">9</span></span><br><span class="line">窗口<span class="number">3</span>:卖票，票号为：<span class="number">8</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">7</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">6</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">5</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">4</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">3</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">2</span></span><br><span class="line">窗口<span class="number">1</span>:卖票，票号为：<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="4-9-Lock锁—Runnable"><a href="#4-9-Lock锁—Runnable" class="headerlink" title="4.9 Lock锁—Runnable"></a>4.9 Lock锁—Runnable</h2><ul>
<li>从JDK 5.0开始，Java提供了更强大的线程同步机制——通过显式定义同步锁对象来实现同步。同步锁使用Lock对象充当。</li>
<li><code>java.util.concurrent.locks.Lock接口是控制多个线程对共享资源进行访问的工具</code>。锁提供了对共享资源的独占访问，每次只能有一个线程对Lock对象加锁，线程开始访问共享资源之前应先获得Lock对象。</li>
<li><code>ReentrantLock 类实现了 Lock</code> ，它拥有与 synchronized 相同的并发性和内存语义，在实现线程安全的控制中，比较常用的是ReentrantLock，可以显式加锁、释放锁。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Window</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticket = <span class="number">50</span>;</span><br><span class="line">    <span class="comment">//1.实例化ReentrantLock,3个窗口共用一个lock对象</span></span><br><span class="line">    <span class="keyword">private</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//2.调用锁定方法lock()</span></span><br><span class="line">                lock.lock();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(ticket &gt; <span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">"：售票，票号为："</span> + ticket);</span><br><span class="line">                    ticket--;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//3.调用解锁方法：unlock()，如果发生Error或Exception,释放锁以免其它进程被阻塞</span></span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Window w = <span class="keyword">new</span> Window();</span><br><span class="line"></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(w);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(w);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(w);</span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">"窗口1"</span>);</span><br><span class="line">        t2.setName(<span class="string">"窗口2"</span>);</span><br><span class="line">        t3.setName(<span class="string">"窗口3"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">50</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">49</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">48</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">47</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">46</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">45</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">44</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">43</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">42</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">41</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">40</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">39</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">38</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">37</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">36</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">35</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">34</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">33</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">32</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">31</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">30</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">29</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">28</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">27</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">26</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">25</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">24</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">23</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">22</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">21</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">20</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">19</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">18</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">17</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">16</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">15</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">14</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">13</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">12</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">11</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">10</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">9</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">8</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">7</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">6</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">5</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">4</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">3</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">2</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="4-10-Locak锁—Thread"><a href="#4-10-Locak锁—Thread" class="headerlink" title="4.10  Locak锁—Thread"></a>4.10  Locak锁—Thread</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Window</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ticket = <span class="number">50</span>;</span><br><span class="line">    <span class="comment">//1.实例化ReentrantLock</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//2.调用锁定方法lock()</span></span><br><span class="line">                lock.lock();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(ticket &gt; <span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">"：售票，票号为："</span> + ticket);</span><br><span class="line">                    ticket--;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//3.调用解锁方法：unlock()</span></span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Window t1=<span class="keyword">new</span> Window();</span><br><span class="line">        Window t2=<span class="keyword">new</span> Window();</span><br><span class="line">        Window t3=<span class="keyword">new</span> Window();</span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">"窗口1"</span>);</span><br><span class="line">        t2.setName(<span class="string">"窗口2"</span>);</span><br><span class="line">        t3.setName(<span class="string">"窗口3"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">50</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">49</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">48</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">47</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">46</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">45</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">44</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">43</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">42</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">41</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">40</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">39</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">38</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">37</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">36</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">35</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">34</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">33</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">32</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">31</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">30</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">29</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">28</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">27</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">26</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">25</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">24</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">23</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">22</span></span><br><span class="line">窗口<span class="number">1</span>：售票，票号为：<span class="number">21</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">20</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">19</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">18</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">17</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">16</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">15</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">14</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">13</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">12</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">11</span></span><br><span class="line">窗口<span class="number">2</span>：售票，票号为：<span class="number">10</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">9</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">8</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">7</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">6</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">5</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">4</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">3</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">2</span></span><br><span class="line">窗口<span class="number">3</span>：售票，票号为：<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="4-11-synchronized-与-Lock-的对比"><a href="#4-11-synchronized-与-Lock-的对比" class="headerlink" title="4.11 synchronized 与 Lock 的对比"></a>4.11 synchronized 与 Lock 的对比</h2><ol>
<li>Lock是显式锁（手动开启和关闭锁，别忘记关闭锁），synchronized是隐式锁，出了作用域自动释放</li>
<li>Lock只有代码块锁，synchronized有代码块锁和方法锁</li>
<li>使用Lock锁，JVM将花费较少的时间来调度线程，性能更好。并且具有更好的扩展性（提供更多的子类）</li>
</ol>
<p><font size=5 color=red>优先使用顺序：</font></p>
<p>Lock &gt;同步代码块（已经进入了方法体，分配了相应资源） &gt;同步方法（在方法体之外）</p>
<h2 id="4-12-一个例子：同步存钱问题"><a href="#4-12-一个例子：同步存钱问题" class="headerlink" title="4.12  一个例子：同步存钱问题"></a>4.12  一个例子：同步存钱问题</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">银行有一个账户。有两个储户分别向同一个账户存3000元，每次存1000，存3次。每次存完打印账户余额。</span></span><br><span class="line"><span class="comment">分析：</span></span><br><span class="line"><span class="comment"> 1.是否是多线程问题？ 是，两个储户线程</span></span><br><span class="line"><span class="comment"> 2.是否有共享数据？ 有，账户（或账户余额）</span></span><br><span class="line"><span class="comment"> 3.是否有线程安全问题？ 有</span></span><br><span class="line"><span class="comment"> 4.需要考虑如何解决线程安全问题？同步机制：有三种方式。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> balance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(<span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//存钱</span></span><br><span class="line">    <span class="comment">//默认监视器(锁)为 acct对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">deposit</span><span class="params">(<span class="keyword">double</span> amt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(amt &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            balance += amt;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">":存钱成功。余额为："</span> + balance);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> <span class="keyword">extends</span>  <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Account acct;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(Account acct)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.acct = acct;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            acct.deposit(<span class="number">1000</span>);	<span class="comment">//调用同步方法，每次存1000</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Account acct = <span class="keyword">new</span> Account(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//c1 c2 两个顾客共用一个账户存钱</span></span><br><span class="line">        Customer c1 = <span class="keyword">new</span> Customer(acct);</span><br><span class="line">        Customer c2 = <span class="keyword">new</span> Customer(acct);</span><br><span class="line"></span><br><span class="line">        c1.setName(<span class="string">"甲"</span>);</span><br><span class="line">        c2.setName(<span class="string">"乙"</span>);</span><br><span class="line"></span><br><span class="line">        c1.start();</span><br><span class="line">        c2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">甲:存钱成功。余额为：<span class="number">1000</span>.<span class="number">0</span></span><br><span class="line">甲:存钱成功。余额为：<span class="number">2000</span>.<span class="number">0</span></span><br><span class="line">甲:存钱成功。余额为：<span class="number">3000</span>.<span class="number">0</span></span><br><span class="line">乙:存钱成功。余额为：<span class="number">4000</span>.<span class="number">0</span></span><br><span class="line">乙:存钱成功。余额为：<span class="number">5000</span>.<span class="number">0</span></span><br><span class="line">乙:存钱成功。余额为：<span class="number">6000</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>


<h1 id="5-线程的死锁"><a href="#5-线程的死锁" class="headerlink" title="5. 线程的死锁"></a>5. 线程的死锁</h1><p><strong>死锁：</strong></p>
<ul>
<li>不同的线程分别占用对方需要的同步资源不放弃，都在等待对方放弃自己需要的同步资源，就形成了线程的死锁</li>
<li>出现死锁后，不会出现异常，不会出现提示，只是所有的线程都处于阻塞状态，无法继续</li>
</ul>
<p><strong>解决方法：</strong></p>
<ul>
<li>专门的算法、原则</li>
<li>尽量减少同步资源的定义</li>
<li>尽量避免嵌套同步</li>
</ul>
<blockquote>
<p>更多理论参考：<a href="https://blog.csdn.net/weixin_43914604/article/details/105437474" target="_blank" rel="noopener">操作系统之死锁详解(预防、避免、检测、解除)</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//死锁的演示</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(B b)</span> </span>&#123; <span class="comment">//同步监视器：A类的对象：a</span></span><br><span class="line">		System.out.println(<span class="string">"当前线程名: "</span> + Thread.currentThread().getName()</span><br><span class="line">				+ <span class="string">" 进入了A实例的foo方法"</span>); <span class="comment">// ①</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">200</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">			ex.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"当前线程名: "</span> + Thread.currentThread().getName()</span><br><span class="line">				+ <span class="string">" 企图调用B实例的last方法"</span>); <span class="comment">// ③</span></span><br><span class="line">		b.last();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">last</span><span class="params">()</span> </span>&#123;<span class="comment">//同步监视器：A类的对象：a</span></span><br><span class="line">		System.out.println(<span class="string">"进入了A类的last方法内部"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">(A a)</span> </span>&#123;<span class="comment">//同步监视器：b</span></span><br><span class="line">		System.out.println(<span class="string">"当前线程名: "</span> + Thread.currentThread().getName()</span><br><span class="line">				+ <span class="string">" 进入了B实例的bar方法"</span>); <span class="comment">// ②</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">200</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">			ex.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"当前线程名: "</span> + Thread.currentThread().getName()</span><br><span class="line">				+ <span class="string">" 企图调用A实例的last方法"</span>); <span class="comment">// ④</span></span><br><span class="line">		a.last();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">last</span><span class="params">()</span> </span>&#123;<span class="comment">//同步监视器：b</span></span><br><span class="line">		System.out.println(<span class="string">"进入了B类的last方法内部"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLock</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	A a = <span class="keyword">new</span> A();</span><br><span class="line">	B b = <span class="keyword">new</span> B();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Thread.currentThread().setName(<span class="string">"主线程"</span>);</span><br><span class="line">		<span class="comment">// 调用a对象的foo方法</span></span><br><span class="line">		a.foo(b);</span><br><span class="line">		System.out.println(<span class="string">"进入了主线程之后"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Thread.currentThread().setName(<span class="string">"副线程"</span>);</span><br><span class="line">		<span class="comment">// 调用b对象的bar方法</span></span><br><span class="line">		b.bar(a);</span><br><span class="line">		System.out.println(<span class="string">"进入了副线程之后"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		DeadLock dl = <span class="keyword">new</span> DeadLock();</span><br><span class="line">		<span class="keyword">new</span> Thread(dl).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		dl.init();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码分析：如果不加sleep，大概率不会发生死锁现象，因为cpu执行速度快，主线程和副线程很大几率可以一次性取得a和b两个对象锁。加了sleep，主线程和副线程就很大几率会出现死锁，因为很可能会导致主线程和副线程都只拿到了一个锁，两个人同时等待对方手里的锁，进而导致死锁现象。</p>
<h1 id="6-线程的通信"><a href="#6-线程的通信" class="headerlink" title="6. 线程的通信"></a>6. 线程的通信</h1><p>线程的通信，即多个线程之间的交流合作，按一定的顺序执行或按一定的规则执行。</p>
<p>这里举一个例子先直观感受一下线程之间的通信方式：<strong>使用两个线程印 打印 1-10 。线程1, 线程2 交替打印</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Object obj = <span class="keyword">new</span> Object();<span class="comment">//可以用obj</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">//也可以用this，同时下面的obj也要换成this</span></span><br><span class="line">            <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line"></span><br><span class="line">                obj.notify();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(number &lt;= <span class="number">10</span>)&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">10</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + number);</span><br><span class="line">                    number++;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//使得调用如下wait()方法的线程进入阻塞状态,并释放锁</span></span><br><span class="line">                        obj.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommunicationTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Number number = <span class="keyword">new</span> Number();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(number);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(number);</span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">"线程1"</span>);</span><br><span class="line">        t2.setName(<span class="string">"线程2"</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">线程<span class="number">1</span>:<span class="number">1</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">2</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">3</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">4</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">5</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">6</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">7</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">8</span></span><br><span class="line">线程<span class="number">1</span>:<span class="number">9</span></span><br><span class="line">线程<span class="number">2</span>:<span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>现在对以上使用的方法说明一下：</p>
<h2 id="6-1-Object用于线程的三个方法"><a href="#6-1-Object用于线程的三个方法" class="headerlink" title="6.1 Object用于线程的三个方法"></a>6.1 Object用于线程的三个方法</h2><p><strong>wait() 与 与 notify() 和 notifyAll()简述：</strong></p>
<ul>
<li>wait()：令当前线程挂起并放弃CPU、同步资源并等待，使别的线程可访问并修改共享资源，而当前线程排队等候其他线程调用notify()或notifyAll()方法唤醒，唤醒后等待重新获得对监视器的所有权后才能继续执行。</li>
<li>notify()：唤醒正在排队等待同步资源的线程中优先级最高者结束等待</li>
<li>notifyAll ()：唤醒正在排队等待资源的所有线程结束等待.</li>
<li>这三个方法只有在synchronized方法或synchronized代码块中才能使用，这三个方法的调用者必须是同步代码块或同步方法中的同步监视器，否则会报<code>java.lang.IllegalMonitorStateException异常</code>。</li>
<li>因为这三个方法必须有锁对象调用，而任意对象都可以作为synchronized的同步锁，因此这三个方法只能在Object类中声明。</li>
</ul>
<p><strong>wait() 方法</strong></p>
<ul>
<li>在当前线程中调用方法： 对象名.wait()</li>
<li>使当前线程进入等待（某对象）状态 ，直到另一线程对该对象发出 notify(或notifyAll) 为止。</li>
<li>调用方法的必要条件：当前线程必须具有对该对象的监控权（加锁）</li>
<li><code>调用此方法后，当前线程将释放对象监控权 ，然后进入等待</code></li>
<li>在当前线程被notify后，要重新获得监控权，然后从断点处继续代码的执行。</li>
</ul>
<p><strong>notify()/notifyAll()</strong></p>
<ul>
<li>在当前线程中调用方法： 对象名.notify()/notifyAll()</li>
<li>功能：唤醒等待该对象监控权的一个/所有线程。</li>
<li>调用方法的必要条件：当前线程必须具有对该对象的监控权（获得锁）</li>
</ul>
<p><strong>面试题：sleep() 和 wait()的异同？</strong><br>1.相同点：一旦执行方法，都可以使得当前的线程进入阻塞状态。<br>2.不同点：</p>
<ul>
<li>两个方法声明的位置不同：Thread类中声明sleep() , Object类中声明wait()</li>
<li>调用的要求不同：sleep()可以在任何需要的场景下调用。 wait()必须使用在同步代码块或同步方法中</li>
<li>关于是否释放同步监视器：如果两个方法都使用在同步代码块或同步方法中，sleep()不会释放锁，wait()会释放锁。</li>
</ul>
<h2 id="6-2-一个生产者-消费者例题"><a href="#6-2-一个生产者-消费者例题" class="headerlink" title="6.2 一个生产者-消费者例题"></a>6.2 一个生产者-消费者例题</h2><p><strong>问题描述：</strong>生产者(Productor)将产品交给店员(Clerk)，而消费者(Customer)从店员处取走产品，店员一次只能持有固定数量的产品(比如:20），如果生产者试图生产更多的产品，店员会叫生产者停一下，如果店中有空位放产品了再通知生产者继续生产；如果店中没有产品了，店员会告诉消费者等一下，如果店中有产品了再通知消费者来取走产品。</p>
<p><img src= "/img/loading.gif" data-src="https://image.bithachi.cn/20200816231207.png" alt="image-20200816231203694"></p>
<p><strong>这里可能出现两个问题：</strong></p>
<ul>
<li>生产者比消费者快时，消费者会漏掉一些数据没有取到。</li>
<li>消费者比生产者快时，消费者会取相同的数据。</li>
</ul>
<p><strong>分析：</strong></p>
<ol>
<li>是否是多线程问题？是，生产者线程，消费者线程</li>
<li>是否有共享数据？是，店员（或产品）</li>
<li>如何解决线程的安全问题？同步机制,有三种方法</li>
<li>是否涉及线程的通信？是</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clerk</span> </span>&#123;<span class="comment">//店员</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> productCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生产产品，默认同步监视器为clerk</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">produceProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (productCount &lt; <span class="number">20</span>) &#123;</span><br><span class="line">            productCount++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">":开始生产第"</span> + productCount + <span class="string">"个产品"</span>);</span><br><span class="line">            notify();<span class="comment">//叫醒消费者</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//等待</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//消费产品，默认同步监视器为clerk</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">consumeProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (productCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">":开始消费第"</span> + productCount + <span class="string">"个产品"</span>);</span><br><span class="line">            productCount--;</span><br><span class="line">            notify();<span class="comment">//叫醒生产者</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//等待</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;<span class="comment">//生产者</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(Clerk clerk)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">":开始生产产品....."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">10</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            clerk.produceProduct();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;<span class="comment">//消费者</span></span><br><span class="line">    <span class="keyword">private</span> Clerk clerk;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(Clerk clerk)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.clerk = clerk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">":开始消费产品....."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">20</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            clerk.consumeProduct();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Clerk clerk = <span class="keyword">new</span> Clerk();</span><br><span class="line"></span><br><span class="line">        Producer p1 = <span class="keyword">new</span> Producer(clerk);</span><br><span class="line">        p1.setName(<span class="string">"生产者1"</span>);</span><br><span class="line"></span><br><span class="line">        Consumer c1 = <span class="keyword">new</span> Consumer(clerk);</span><br><span class="line">        c1.setName(<span class="string">"消费者1"</span>);</span><br><span class="line">        Consumer c2 = <span class="keyword">new</span> Consumer(clerk);</span><br><span class="line">        c2.setName(<span class="string">"消费者2"</span>);</span><br><span class="line"></span><br><span class="line">        p1.start();</span><br><span class="line">        c1.start();</span><br><span class="line">        c2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行的部分结果：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">生产者<span class="number">1</span>:开始生产产品.....</span><br><span class="line">消费者<span class="number">2</span>:开始消费产品.....</span><br><span class="line">消费者<span class="number">1</span>:开始消费产品.....</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">1</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">2</span>个产品</span><br><span class="line">消费者<span class="number">1</span>:开始消费第<span class="number">2</span>个产品</span><br><span class="line">消费者<span class="number">2</span>:开始消费第<span class="number">1</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">1</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">2</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">3</span>个产品</span><br><span class="line">消费者<span class="number">2</span>:开始消费第<span class="number">3</span>个产品</span><br><span class="line">消费者<span class="number">1</span>:开始消费第<span class="number">2</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">2</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">3</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">4</span>个产品</span><br><span class="line">消费者<span class="number">1</span>:开始消费第<span class="number">4</span>个产品</span><br><span class="line">消费者<span class="number">2</span>:开始消费第<span class="number">3</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">3</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">4</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">5</span>个产品</span><br><span class="line">消费者<span class="number">1</span>:开始消费第<span class="number">5</span>个产品</span><br><span class="line">消费者<span class="number">2</span>:开始消费第<span class="number">4</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">4</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">5</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">6</span>个产品</span><br><span class="line">消费者<span class="number">1</span>:开始消费第<span class="number">6</span>个产品</span><br><span class="line">消费者<span class="number">2</span>:开始消费第<span class="number">5</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">5</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">6</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">7</span>个产品</span><br><span class="line">消费者<span class="number">2</span>:开始消费第<span class="number">7</span>个产品</span><br><span class="line">消费者<span class="number">1</span>:开始消费第<span class="number">6</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">6</span>个产品</span><br><span class="line">生产者<span class="number">1</span>:开始生产第<span class="number">7</span>个产品</span><br><span class="line">…………………………………………………………</span><br></pre></td></tr></table></figure>



<h1 id="7-参考文献"><a href="#7-参考文献" class="headerlink" title="7. 参考文献"></a>7. 参考文献</h1><ul>
<li><a href="https://redspider.gitbook.io/concurrent/" target="_blank" rel="noopener">https://redspider.gitbook.io/concurrent/</a></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">BitHachi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.bithachi.cn/posts/b9904a01.html">https://www.bithachi.cn/posts/b9904a01.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.bithachi.cn" target="_blank">BitHachi</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Thread/">Thread</a></div><div class="post_share"></div></div><div class="post-reward"><button class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.png" alt="微信" onclick="window.open('/img/wechat.png')"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.png" alt="支付宝" onclick="window.open('/img/alipay.png')"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/8f28afe1.html"><img class="prev-cover" data-src="https://cdn.pixabay.com/photo/2016/12/05/11/39/fox-1883658__340.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java常用类操作手册</div></div></a></div><div class="next-post pull-right"><a href="/posts/3aa86aea.html"><img class="next-cover" data-src="https://cdn.pixabay.com/photo/2016/06/14/09/58/cat-1456173__340.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">枚举类与注解</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'NRvlHdgJSxUn4u8Q1sgVDnlP-gzGzoHsz',
  appKey: '5sa3oi8Nwmzfo8zdXrnvibI0',
  placeholder: '记得留下你的昵称和邮箱....可以快速收到回复',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://images.pexels.com/photos/2072599/pexels-photo-2072599.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=650&amp;w=940)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By BitHachi</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my blog.</div><div class="icp"><a href="http://www.beian.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>鄂ICP备20002680号</span></a></div></div><div class="container" id="jsi-flying-fish-container"></div><script src="js/fish.js"></script><style>@media only screen and (max-width: 767px){
#sidebar_search_box input[type=text]{width:calc(100%)}
}</style></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">简</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fas fa-comments"></i></a><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/third-party/click_heart.js"></script><script src="https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
  pangu.autoSpacingPage()
})</script><script src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fish.js"></script></body></html>